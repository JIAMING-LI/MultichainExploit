# Multichain Exploit

This is a demo for the exploit happened on Jan-18-2022

attacker address - https://etherscan.io/address/0x4986e9017ea60e7afcd10d844f85c80912c3863c

## Installation & Run

```bash
npm install
npx hardhat run scripts/execute.js
```

## Explanation
Let dive into the transaction to see which function in Multichain router getting called. I am using 
Blocksecteam here, https://versatile.blocksecteam.com/tx/eth/0xd07c0f40eec44f7674dddf617cbdec4758f258b531e99b18b8ee3b3b95885e7d

![](./1.png)

We can see that this function is getting called `anySwapOutUnderlyingWithPermit`.  By reading the source code of `anySwapOutUnderlyingWithPermit` and the malicious input, we can see that `AnyswapV4Router` contract didn't do any sanity check to verify the input so any malicious contract like `Multichain Exploiter 3` can pretend to be a AnyswapV1ERC20 Token. 
As you can notice that a call to WETH permit somehow emits a `deposit` event, it is another issue that make this exploit possible. WETH doesn't implement `permit` function as it is a standard [EIP-2612](https://eips.ethereum.org/EIPS/eip-2612) introduced after WETH contract is deployed, so a call to WETH `permit` will execute the fallback function
```solidity
function() public payable {
    deposit();
}
```

Then WETH `transferFrom` will also successfully executed since the targeted victim have already given AnyswapRouter approval to move their assets.
Finally `Multichain Exploiter 3.depositValue()` & `Multichain Exploiter 3.burn()` are also controllable by the malicious contract. So far every line of function `anySwapOutUnderlyingWithPermit` successfully executed ï¼Œ so the entire transaction went through and result in lost of more than 450 ether.


## Disclaimer
This codebase is for demonstration purposes only

## License
[MIT](https://choosealicense.com/licenses/mit/)